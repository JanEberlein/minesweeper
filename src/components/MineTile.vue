<script setup>
import { gameOver, getCell } from '@/store'
import { computed } from 'vue'

const props = defineProps({
  row: {
    type: Number,
    required: true
  },
  column: {
    type: Number,
    required: true
  }
})

const cell = getCell(props.row, props.column)

var obstaclesNearby = 0
function getSurroundingCells(row, column) {}

function revealCell() {
  if (gameOver.value) return
  if (cell.value.marked == '🚩') return
  cell.value.revealed = true
  if (cell.value.obstacle) gameOver.value = true
}

function markCell() {
  if(gameOver.value) return
  switch (cell.value.marked) {
    case '':
      cell.value.marked = '🚩'
      break
    case '🚩':
      cell.value.marked = '❓'
      break
    default:
      cell.value.marked = ''
      break
  }
}

const cellContent = computed(() => {
  //TODO
  return ''
})
</script>

<template>
  <div
    class="flex items-center justify-center m-1 h-8 w-8 p-0 shadow-inner text-balance text-lg hover:m-0 hover:h-10 hover:w-10 hover:text-2xl"
    :class="{      
      'bg-red-500': cell.revealed && cell.obstacle && gameOver,
      'bg-slate-300': !(cell.revealed && cell.obstacle && gameOver),
      'shadow-slate-400 border-r-2 border-b-2 border-slate-200': cell.revealed,
      'shadow-slate-200 border-r-2 border-b-2 border-slate-300': !cell.revealed}"
    @click="revealCell"
    @click.right.prevent="markCell"
  >
    <div v-if="cell.revealed">
      {{ cellContent }}
    </div>
    <div v-else class="drop-shadow-md saturate-200">
      {{ cell.marked }}
    </div>
  </div>
</template>
